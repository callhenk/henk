# Development Standards

## 🏗 Architecture Principles

### **Monorepo Structure**

- **apps/web**: Main Next.js application
- **packages/ui**: Reusable UI components (`@kit/ui`)
- **packages/features**: Modular feature packages
- **packages/supabase**: Database utilities and hooks
- **packages/shared**: Shared utilities and types

### **Component Organization**

```typescript
// ✅ Good: Use existing components from @kit/ui
import { Button } from '@kit/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@kit/ui/card';
import { PageBody, PageHeader } from '@kit/ui/page';

// ✅ Good: Create reusable components in packages/ui
// packages/ui/src/henk/form-section.tsx

// ❌ Avoid: Creating duplicate components
// Don't recreate Button, Card, etc.—use @kit/ui
```

## 📝 Code Standards

### **TypeScript Standards**

```typescript
// ✅ Good: Proper interfaces and types
interface Campaign {
  id: string;
  name: string;
  status: 'draft' | 'active' | 'paused' | 'completed';
  leads: number;
  contacted: number;
  conversions: number;
  revenue: number;
  startDate: string;
  endDate?: string;
  description: string;
  agent_id: string;
  calling_hours: string;
  max_attempts: number;
  daily_call_cap: number;
  script: string;
  retry_logic: string;
}

// ✅ Good: Strict typing for props
interface CampaignDetailProps {
  campaignId: string;
}

// ✅ Good: Proper async/await for Next.js 15
export default async function CampaignPage({
  params,
}: {
  params: Promise<{ id: string }>;
}) {
  const { id } = await params;
  // ...
}
```

### **React Component Standards**

```typescript
// ✅ Good: Standard page structure
export default function CampaignsPage() {
  return (
    <>
      <PageHeader
        title="Campaigns"
        description="Manage your AI voice fundraising campaigns"
      />
      <PageBody>
        <CampaignsList />
      </PageBody>
    </>
  );
}

// ✅ Good: Proper hooks usage
export function CampaignsList() {
  const router = useRouter();
  const [selectedTab, setSelectedTab] = useState('all');
  const [searchTerm, setSearchTerm] = useState('');

  const getFilteredCampaigns = useCallback(() => {
    // Filter logic
  }, [selectedTab, searchTerm]);
}
```

### **Styling Standards**

```typescript
// ✅ Good: Consistent Tailwind classes
<div className="space-y-6">
  <Card>
    <CardHeader>
      <CardTitle className="text-sm font-medium">Title</CardTitle>
    </CardHeader>
    <CardContent>
      <p className="text-muted-foreground text-xs">Description</p>
    </CardContent>
  </Card>
</div>

// ✅ Good: Responsive design
<div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
  {/* Cards */}
</div>

// ✅ Good: Consistent spacing
<div className="space-y-4">
  <div className="flex items-center justify-between">
    {/* Header content */}
  </div>
  <div className="space-y-2">
    {/* Content */}
  </div>
</div>
```

## 🎨 UI/UX Standards

### **Page Layout Patterns**

```typescript
// ✅ Standard page structure with proper padding
export default function ExamplePage() {
  return (
    <>
      <PageHeader
        title="Page Title"
        description="Page description"
      />
      <PageBody>
        {/* Content with automatic padding from layout */}
      </PageBody>
    </>
  );
}
```

### **Form Patterns**

```typescript
// ✅ Good: Use FormSection component
import { FormSection } from '~/components/form-styles';

export function CampaignForm() {
  return (
    <div className="mx-auto max-w-4xl space-y-8">
      <FormSection title="Campaign Details">
        {/* Form fields */}
      </FormSection>
      <FormSection title="Settings">
        {/* More form fields */}
      </FormSection>
    </div>
  );
}
```

### **Table Patterns**

```typescript
// ✅ Good: Consistent table structure
<Table>
  <TableHeader>
    <TableRow>
      <TableHead>Name</TableHead>
      <TableHead>Status</TableHead>
      <TableHead className="text-right">Actions</TableHead>
    </TableRow>
  </TableHeader>
  <TableBody>
    {items.map((item) => (
      <TableRow key={item.id}>
        <TableCell>
          <div>
            <div className="font-medium">{item.name}</div>
            <div className="text-muted-foreground text-sm">
              {item.description}
            </div>
          </div>
        </TableCell>
        <TableCell>{getStatusBadge(item.status)}</TableCell>
        <TableCell className="text-right">
          {/* Actions */}
        </TableCell>
      </TableRow>
    ))}
  </TableBody>
</Table>
```

### **Empty State Patterns**

```typescript
// ✅ Good: Proper empty state handling
export function ConversationsList() {
  if (conversations.length === 0) {
    return (
      <div className="flex flex-col items-center justify-center py-12 text-center">
        <MessageSquare className="h-12 w-12 text-muted-foreground mb-4" />
        <h3 className="text-lg font-semibold mb-2">No conversations yet</h3>
        <p className="text-muted-foreground mb-4">
          Start a campaign to begin generating conversations
        </p>
        <div className="flex gap-2">
          <Button onClick={() => router.push('/home/campaigns')}>
            Create Campaign
          </Button>
          <Button variant="outline" onClick={() => router.push('/home/analytics')}>
            View Analytics
          </Button>
        </div>
      </div>
    );
  }
}
```

## 🔧 Component Guidelines

### **Reusable Components**

1. **Check `@kit/ui` first** before creating new components
2. **Use established patterns** from existing components
3. **Create in `packages/ui`** if truly reusable
4. **Follow naming conventions** and file structure

### **Component Structure**

```typescript
// ✅ Good: Proper component structure
'use client';

import { useState, useCallback } from 'react';
import { useRouter } from 'next/navigation';
import { Button } from '@kit/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@kit/ui/card';

interface ComponentProps {
  // Proper TypeScript interfaces
}

export function ComponentName({ prop }: ComponentProps) {
  // Hooks at the top
  const router = useRouter();
  const [state, setState] = useState();

  // Helper functions
  const handleAction = useCallback(() => {
    // Action logic
  }, []);

  // Render
  return (
    <Card>
      <CardHeader>
        <CardTitle>Title</CardTitle>
      </CardHeader>
      <CardContent>
        {/* Content */}
      </CardContent>
    </Card>
  );
}
```

### **Error Handling**

```typescript
// ✅ Good: Proper error boundaries and loading states
export default function Page() {
  return (
    <Suspense fallback={<LoadingOverlay />}>
      <PageContent />
    </Suspense>
  );
}

// ✅ Good: Loading components
export function LoadingOverlay() {
  return (
    <div className="flex items-center justify-center h-64">
      <Spinner />
    </div>
  );
}
```

## 📊 Data Management

### **Supabase Hooks Usage**

```typescript
// ✅ Good: Use Supabase hooks for data fetching
import { useAgents } from '@kit/supabase/hooks/agents/use-agents';
import { useCampaigns } from '@kit/supabase/hooks/campaigns/use-campaigns';
import { useConversations } from '@kit/supabase/hooks/conversations/use-conversations';

export function CampaignsList() {
  const { data: campaigns = [], isLoading } = useCampaigns();
  const { data: agents = [] } = useAgents();
  const { data: conversations = [] } = useConversations();

  // Enhanced data with calculated fields
  const enhancedCampaigns = useMemo(() => {
    return campaigns.map((campaign) => {
      const agent = agents.find((a) => a.id === campaign.agent_id);
      const campaignConversations = conversations.filter(
        (conv) => conv.campaign_id === campaign.id,
      );

      return {
        ...campaign,
        agentName: agent?.name || 'Unknown',
        contacted: campaignConversations.length,
        conversions: campaignConversations.filter(
          (conv) => conv.outcome === 'donated',
        ).length,
      };
    });
  }, [campaigns, agents, conversations]);
}
```

### **State Management**

```typescript
// ✅ Good: Use React hooks properly
const [selectedTab, setSelectedTab] = useState('all');
const [filteredData, setFilteredData] = useState([]);

// ✅ Good: Memoized calculations
const getTotalStats = useCallback(() => {
  return {
    total: data.length,
    active: data.filter((item) => item.status === 'active').length,
    // ...
  };
}, [data]);
```

## 🎯 Performance Standards

### **Optimization Guidelines**

1. **Use `React.memo`** for expensive components
2. **Implement proper loading states**
3. **Lazy load components** when appropriate
4. **Optimize images** with Next.js `<Image>` component
5. **Use proper `key` props** in lists

### **Bundle Optimization**

```typescript
// ✅ Good: Dynamic imports for heavy components
const WorkflowBuilder = dynamic(() => import('./workflow-builder'), {
  loading: () => <LoadingOverlay />,
  ssr: false,
});

// ✅ Good: Proper icon imports
import { Plus, Edit, Trash2 } from 'lucide-react';
```

### **Data Optimization**

```typescript
// ✅ Good: Efficient data filtering and calculations
const filteredCampaigns = useMemo(() => {
  return campaigns.filter((campaign) => {
    if (selectedTab !== 'all' && campaign.status !== selectedTab) {
      return false;
    }
    if (
      searchTerm &&
      !campaign.name.toLowerCase().includes(searchTerm.toLowerCase())
    ) {
      return false;
    }
    return true;
  });
}, [campaigns, selectedTab, searchTerm]);
```

## 🔍 Code Quality

### **Linting Standards**

- **Fix all TypeScript errors** before committing
- **Use proper import/export** statements
- **Follow ESLint rules** consistently
- **Remove unused imports** and variables
- **Use proper dependency arrays** in hooks

### **Documentation Standards**

```typescript
// ✅ Good: Proper JSDoc comments
/**
 * Campaign management component
 * Handles listing, filtering, and actions for campaigns
 */
export function CampaignsList() {
  // Component implementation
}

// ✅ Good: Interface documentation
interface Campaign {
  /** Unique identifier for the campaign */
  id: string;
  /** Display name of the campaign */
  name: string;
  /** Current status of the campaign */
  status: 'draft' | 'active' | 'paused' | 'completed';
  // ...
}
```

## 🚀 Deployment Standards

### **Environment Variables**

```bash
# ✅ Good: Proper environment setup
NEXT_PUBLIC_SITE_URL=https://app.callhenk.com
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_anon_key
ELEVENLABS_API_KEY=your_elevenlabs_key
```

### **Build Optimization**

- **Use proper Next.js 15 features**
- **Implement proper caching strategies**
- **Optimize images and static assets**
- **Use proper error boundaries**

## 🎨 UI/UX Guidelines

### **Layout Consistency**

```typescript
// ✅ Good: Consistent page structure
export default function Page() {
  return (
    <>
      <PageHeader
        title="Page Title"
        description="Page description"
      />
      <PageBody>
        {/* Content with automatic responsive padding */}
      </PageBody>
    </>
  );
}
```

### **Responsive Design**

```typescript
// ✅ Good: Mobile-first responsive design
<div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
  {/* Responsive grid */}
</div>

<div className="flex flex-col space-y-4 sm:flex-row sm:space-x-4 sm:space-y-0">
  {/* Responsive flex layout */}
</div>
```

### **Accessibility**

```typescript
// ✅ Good: Proper accessibility attributes
<Button
  aria-label="Edit campaign"
  onClick={handleEdit}
>
  <Edit className="h-4 w-4" />
</Button>

// ✅ Good: Proper form labels
<FormField
  control={form.control}
  name="name"
  render={({ field }) => (
    <FormItem>
      <FormLabel>Campaign Name</FormLabel>
      <FormControl>
        <Input placeholder="Enter campaign name" {...field} />
      </FormControl>
      <FormMessage />
    </FormItem>
  )}
/>
```

## 📋 Checklist for New Features

### **Before Implementation**

- [ ] Check existing components in `@kit/ui`
- [ ] Review similar pages for patterns
- [ ] Plan proper TypeScript interfaces
- [ ] Design responsive layout
- [ ] Consider accessibility requirements

### **During Implementation**

- [ ] Use `PageHeader` + `PageBody` structure
- [ ] Implement proper loading states
- [ ] Add comprehensive data handling
- [ ] Follow established styling patterns
- [ ] Include proper error handling
- [ ] Use Supabase hooks for data fetching

### **After Implementation**

- [ ] Update documentation (markdown files)
- [ ] Test responsive behavior
- [ ] Verify TypeScript compliance
- [ ] Check accessibility
- [ ] Review performance impact
- [ ] Run linting and fix issues

## 🔧 Development Workflow

### **Code Organization**

1. **Follow the established file structure**
2. **Use consistent naming conventions**
3. **Group related components together**
4. **Keep components focused and single-purpose**

### **Testing Guidelines**

- **Test responsive behavior** on different screen sizes
- **Verify TypeScript types** are correct
- **Check for accessibility** issues
- **Test error states** and edge cases

### **Performance Considerations**

- **Use React.memo** for expensive components
- **Implement proper loading states**
- **Optimize data fetching** with proper caching
- **Lazy load** heavy components when appropriate

- [ ] Verify TypeScript compliance
- [ ] Check accessibility
- [ ] Review performance impact
